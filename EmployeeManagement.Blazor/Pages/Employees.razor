@page "/employees"
@using System.Net.Http.Json
@using EmployeeManagement.Blazor.Models
@using EmployeeManagement.Blazor.Layout
@using EmployeeManagement.Blazor.Ui
@inject NavigationManager NavigationManager
@inject HttpClient Http
@code {

    [CascadingParameter]
    public Action<string> SetTitle { get; set; } = default!;
    protected override void OnInitialized()
        {
            // Cáº­p nháº­t tiÃªu Ä‘á» cho trang Employees
            SetTitle?.Invoke("Employees");
        }
}

@* <EmployeeManagement.Blazor.Layout.PageTitle>@currentPageTitle</EmployeeManagement.Blazor.Layout.PageTitle> *@
<div>
    <h3>Employee Management</h3>
    <p>Manage all employees in your organization. Add new employees, update information, or remove employees who have left the company.</p>
</div>

<hr>

<div class="mb-3">
    <a class="btn btn-primary" href="/add">Add New Employee</a>
    <a class="btn btn-secondary" href="/reports">View Reports</a>
</div>

@if (employeeDtos == null || employeeDtos.Count == 0)
{
    <p><em>No employees found </em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Há»</th>
                <th>TÃªn</th>
                <th>Quá»‘c tá»‹ch</th>
                <th>Há»™ chiáº¿u</th>
                <th>Chá»©ng chá»‰</th>
                <th>Sá»‘ My Number</th>
                <th>Ghi chÃº</th>
                <th>Äá»‹a chá»‰</th>
                <th>Äiá»‡n thoáº¡i</th>
                <th>Email</th>
                <th>LÆ°Æ¡ng</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var emp in employeeDtos)
            {
                <tr>
                    <td>@emp.Id</td>
                    <td>@emp.FirstName</td>
                    <td>@emp.LastName</td>
                    <td>@emp.KokuSeki</td>
                    <td>@emp.Passport</td>
                    <td>@emp.Shikaku</td>
                    <td>@emp.MyNumber</td>
                    <td>@emp.BiKou</td>
                    <td>@emp.JuuSho</td>
                    <td>@emp.Keitai</td>
                    <td>@emp.Mail</td>
                    <td>@emp.Salary</td>
                    @*<td>Created At: @emp.CreatedAt.ToString("yyyy/MM/dd HH:mm:ss")</td> *@
                    @*<td>Updated At: @emp.UpdatedAt.ToString("yyyy/MM/dd HH:mm:ss")</td> *@
                    <td>
                        <a href="/details/@emp.Id">ğŸ” employee details</a> @* ç¤¾å“¡æƒ…å ±è©³ç´° *@
                        <a href="/update/@emp.Id">âœï¸ Edit</a> @* ç¤¾å“¡æƒ…å ±æ›´æ–° *@
                        <button class="btn btn-danger btn-sm" @onclick="() => ConfirmDelete(emp.Id)">ğŸ—‘ Delete</button> @* ç¤¾å“¡æƒ…å ±å‰Šé™¤ *@
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<Alert @ref="alert" Title= "Add Employee" Message="Are you sure want to add this employee?" OnConfirm="ConfirmDel" OnCancel="CancelDel" />

@code {
    private List<DtoEmployee> employeeDtos = new List<DtoEmployee>();
    private Alert alert = default!;
    private int employeeIdToDelete;
    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Gá»i API tá»« nhÃ¡nh backend Ä‘á»ƒ láº¥y danh sÃ¡ch nhÃ¢n viÃªn
            employeeDtos = await Http.GetFromJsonAsync<List<DtoEmployee>>("api/employees/getAll") ?? new List<DtoEmployee>();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error While calling Api: {ex.Message}");
        }
    }

    protected async Task ConfirmDelete(int id)
    {
        employeeIdToDelete = id;
        await alert.ShowAsync();
    }
    
    private void ConfirmDel()
    {
        NavigationManager.NavigateTo($"/delete/{employeeIdToDelete}");
    }
    private void CancelDel()
    {
        // Xá»­ lÃ½ há»§y thÃªm nhÃ¢n viÃªn á»Ÿ Ä‘Ã¢y
        Console.WriteLine("NgÆ°á»i dÃ¹ng Ä‘Ã£ há»§y thao tÃ¡c xÃ³a nhÃ¢n viÃªn.");
    }
}
